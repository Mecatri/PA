function revalidarPT() {
    const operadorRevalidacao = document.getElementById('operadorRevalidacao').value;
    const dataReavaliacao = document.getElementById('dataReavaliacao').value;
    const { ordem } = getQueryParams();
    const user = auth.currentUser;

    if (!operadorRevalidacao || !dataReavaliacao) {
        alert('Preencha o nome do operador e a data/hora da revalidação.');
        return;
    }

    db.collection('formularios')
      .where('ordem', '==', ordem)
      .get()
      .then(querySnapshot => {
        if (!querySnapshot.empty) {
            const docRef = querySnapshot.docs[0].ref;
            const docData = querySnapshot.docs[0].data();
            const operadoresRevalidacao = Array.isArray(docData.operadoresRevalidacao) ? docData.operadoresRevalidacao : [];

            // Adiciona o novo operador revalidador com UID e data/hora
            operadoresRevalidacao.push({
                nome: operadorRevalidacao,
                dataRevalidacao: dataReavaliacao,
                uid: user.uid
            });

            // Atualiza ou cria o array de participantes
            const uidsParticipantes = Array.isArray(docData.uidsParticipantes) ? docData.uidsParticipantes : [];
            if (!uidsParticipantes.includes(user.uid)) {
                uidsParticipantes.push(user.uid);
            }

            return docRef.update({
                operadoresRevalidacao,
                uidsParticipantes
            });
        } else {
            alert('Documento não encontrado para revalidar.');
        }
      })
      .then(() => {
        alert('PT Revalidada com sucesso!');
        preencherFormulario();
      })
      .catch(error => {
        console.error("Erro ao revalidar PT:", error);
        alert('Erro ao revalidar PT: ' + error.message);
      });
}
