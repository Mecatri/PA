<script>
  function gerarQRCode() {
    const descricao = document.getElementById("descricao").value.trim();
    const inicio = document.getElementById("inicio").value;
    const fim = document.getElementById("fim").value;
    const mensagem = document.getElementById("mensagem");

    if (!descricao || !inicio || !fim) {
      mensagem.textContent = "Por favor, preencha todos os campos.";
      return;
    }

    if (new Date(inicio) >= new Date(fim)) {
      mensagem.textContent = "A data de início deve ser anterior à data de término.";
      return;
    }

    mensagem.textContent = "";

    const url = `https://seu-dominio.com/formulario.html?descricao=${encodeURIComponent(descricao)}&inicio=${inicio}&fim=${fim}`;

    const container = document.getElementById("qrcode");
    container.innerHTML = "";
    const canvas = document.createElement("canvas");
    container.appendChild(canvas);

    QRCode.toCanvas(canvas, url, function (error) {
      if (error) {
        console.error(error);
        container.innerHTML = "<p>Erro ao gerar QR Code</p>";
      } else {
        // ✅ Exibir descrição abaixo do QR Code
        const legenda = document.createElement("p");
        legenda.style.marginTop = "10px";
        legenda.style.fontWeight = "bold";
        legenda.style.textAlign = "center";
        legenda.textContent = descricao;
        container.appendChild(legenda);

        const link = document.createElement("p");
        link.innerHTML = `Link gerado: <a href="${url}" target="_blank">${url}</a>`;
        container.appendChild(link);
      }
    });

    const atividade = { descricao, inicio, fim, url };
    let atividades = JSON.parse(localStorage.getItem("atividades")) || [];
    atividades.push(atividade);
    localStorage.setItem("atividades", JSON.stringify(atividades));

    mostrarHistorico();

    mensagem.textContent = "QR Code gerado com sucesso!";
    mensagem.className = "success";
  }
</script>
