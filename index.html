<!DOCTYPE html>

<html lang="pt-BR">

<head>

Â  <meta charset="UTF-8">

Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  <title>Gerador de QR Code - Atividades</title>

Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>

Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

Â  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

Â  <style>

Â  Â  body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }

Â  Â  label { display: block; margin-top: 10px; }

Â  Â  input, textarea { width: 100%; padding: 8px; margin-top: 5px; }

Â  Â  button { margin-top: 15px; padding: 10px 15px; }

Â  Â  #qrcode { margin-top: 20px; text-align: center; }

Â  Â  #historico { margin-top: 30px; }

Â  Â  .atividade { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }

Â  Â  .atividade a { word-break: break-word; }

Â  Â  .error { color: red; margin-top: 10px; }

Â  Â  .success { color: green; margin-top: 10px; }

Â  Â  .delete-btn { background-color: red; color: white; border: none; padding: 5px 10px; cursor: pointer; }

Â  Â  @media (max-width: 600px) {

Â  Â  Â  body { padding: 10px; }

Â  Â  Â  button { width: 100%; }

Â  Â  }

Â  </style>

</head>

<body>

Â  <h2>Gerador de QR Code - Atividade</h2>



Â  <!-- Ãrea de Login -->

Â  <div id="login">

Â  Â  <h3>Login</h3>

Â  Â  <button onclick="login()">Entrar com Gmail</button>

Â  Â  <p id="loginMessage"></p>

Â  </div>



Â  <!-- Ãrea do Aplicativo (oculta atÃ© login) -->

Â  <div id="app" style="display: none;">

Â  Â  <label for="descricao">DescriÃ§Ã£o da Atividade</label>

Â  Â  <textarea id="descricao" rows="3" placeholder="Ex: Troca da vÃ¡lvula CV-210"></textarea>



Â  Â  <label for="inicio">Data e Hora de InÃ­cio Prevista</label>

Â  Â  <input type="datetime-local" id="inicio">



Â  Â  <label for="fim">Data e Hora de TÃ©rmino Prevista</label>

Â  Â  <input type="datetime-local" id="fim">



Â  Â  <button onclick="gerarQRCode()">Gerar QR Code</button>



Â  Â  <div id="qrcode"></div>

Â  Â  <p id="mensagem" class="error"></p>



Â  Â  <div id="historico">

Â  Â  Â  <h3>ðŸ“‚ HistÃ³rico de Atividades Geradas</h3>

Â  Â  Â  <div id="listaAtividades"></div>

Â  Â  </div>



Â  Â  <button onclick="logout()">Sair</button>

Â  </div>



Â  <script>

Â  Â  // ConfiguraÃ§Ã£o do Firebase

Â  Â  const firebaseConfig = {

Â  Â  Â  apiKey: "AIzaSyCaZC2E6EpcC8Xl4lOTDQA3n3lMTP6NxwQ",

Â  Â  Â  authDomain: "pa-pg-a7abc.firebaseapp.com",

Â  Â  Â  projectId: "pa-pg-a7abc",

Â  Â  Â  storageBucket: "pa-pg-a7abc.firebasestorage.app",

Â  Â  Â  messagingSenderId: "102164980919",

Â  Â  Â  appId: "1:102164980919:web:72220a8b2ed478a2cdd932",

Â  Â  Â  clientId: "460190166657-18jbdvae4cemj3n38ivsnol1r975nkee.apps.googleusercontent.com"

Â  Â  };



Â  Â  // Inicialize o Firebase

Â  Â  firebase.initializeApp(firebaseConfig);



Â  Â  // Inicialize os serviÃ§os do Firebase

Â  Â  const auth = firebase.auth();

Â  Â  const db = firebase.firestore();



Â  Â  // FunÃ§Ã£o de login com Gmail

Â  Â  function login() {

Â  Â  Â  const provider = new firebase.auth.GoogleAuthProvider();

Â  Â  Â  provider.setCustomParameters({ client_id: firebaseConfig.clientId });



Â  Â  Â  auth.signInWithPopup(provider)

Â  Â  Â  Â  .then((result) => {

Â  Â  Â  Â  Â  console.log("UsuÃ¡rio logado:", result.user);

Â  Â  Â  Â  Â  document.getElementById("login").style.display = "none";

Â  Â  Â  Â  Â  document.getElementById("app").style.display = "block";

Â  Â  Â  Â  Â  document.getElementById("loginMessage").textContent = "";

Â  Â  Â  Â  Â  mostrarHistorico();

Â  Â  Â  Â  })

Â  Â  Â  Â  .catch((error) => {

Â  Â  Â  Â  Â  console.error("Erro no login:", error);

Â  Â  Â  Â  Â  document.getElementById("loginMessage").textContent = "Erro no login: " + error.message;

Â  Â  Â  Â  });

Â  Â  }



Â  Â  // FunÃ§Ã£o de logout

Â  Â  function logout() {

Â  Â  Â  auth.signOut()

Â  Â  Â  Â  .then(() => {

Â  Â  Â  Â  Â  console.log("UsuÃ¡rio deslogado");

Â  Â  Â  Â  Â  document.getElementById("login").style.display = "block";

Â  Â  Â  Â  Â  document.getElementById("app").style.display = "none";

Â  Â  Â  Â  })

Â  Â  Â  Â  .catch((error) => {

Â  Â  Â  Â  Â  console.error("Erro ao sair:", error);

Â  Â  Â  Â  });

Â  Â  }



Â  Â  // Verificar estado de autenticaÃ§Ã£o

Â  Â  auth.onAuthStateChanged((user) => {

Â  Â  Â  if (user) {

Â  Â  Â  Â  console.log("UsuÃ¡rio autenticado:", user);

Â  Â  Â  Â  document.getElementById("login").style.display = "none";

Â  Â  Â  Â  document.getElementById("app").style.display = "block";

Â  Â  Â  Â  mostrarHistorico();

Â  Â  Â  } else {

Â  Â  Â  Â  console.log("Nenhum usuÃ¡rio autenticado");

Â  Â  Â  Â  document.getElementById("login").style.display = "block";

Â  Â  Â  Â  document.getElementById("app").style.display = "none";

Â  Â  Â  }

Â  Â  });



Â  Â  // FunÃ§Ã£o para gerar QR Code

Â  Â  async function gerarQRCode() {

Â  Â  Â  if (!auth.currentUser) {

Â  Â  Â  Â  alert("VocÃª precisa estar logado para realizar esta aÃ§Ã£o.");

Â  Â  Â  Â  return;

Â  Â  Â  }



Â  Â  Â  const descricao = document.getElementById("descricao").value.trim();

Â  Â  Â  const inicio = document.getElementById("inicio").value;

Â  Â  Â  const fim = document.getElementById("fim").value;

Â  Â  Â  const mensagem = document.getElementById("mensagem");



Â  Â  Â  if (!descricao || !inicio || !fim) {

Â  Â  Â  Â  mensagem.textContent = "Por favor, preencha todos os campos.";

Â  Â  Â  Â  return;

Â  Â  Â  }



Â  Â  Â  if (new Date(inicio) >= new Date(fim)) {

Â  Â  Â  Â  mensagem.textContent = "A data de inÃ­cio deve ser anterior Ã  data de tÃ©rmino.";

Â  Â  Â  Â  return;

Â  Â  Â  }



Â  Â  Â  mensagem.textContent = "";



Â  Â  Â  // URL da pÃ¡gina do formulÃ¡rio com parÃ¢metros

Â  Â  Â  const url = `https://mecatri.github.io/PA/formulario.html?descricao=${encodeURIComponent(descricao)}&inicio=${encodeURIComponent(inicio)}&fim=${encodeURIComponent(fim)}`;

Â  Â  Â  const container = document.getElementById("qrcode");

Â  Â  Â  container.innerHTML = "";

Â  Â  Â  const canvas = document.createElement("canvas");

Â  Â  Â  container.appendChild(canvas);



Â  Â  Â  // Gerar QR Code

Â  Â  Â  QRCode.toCanvas(canvas, url, function (error) {

Â  Â  Â  Â  if (error) {

Â  Â  Â  Â  Â  console.error(error);

Â  Â  Â  Â  Â  container.innerHTML = "<p>Erro ao gerar QR Code</p>";

Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  const link = document.createElement("p");

Â  Â  Â  Â  Â  link.innerHTML = `Link gerado: <a href="${url}" target="_blank">${url}</a><br><strong>${descricao}</strong>`;

Â  Â  Â  Â  Â  container.appendChild(link);

Â  Â  Â  Â  }

Â  Â  Â  });



Â  Â  Â  // Salvar no Firestore

Â  Â  Â  const atividade = { descricao, inicio, fim, url, userId: auth.currentUser.uid };

Â  Â  Â  try {

Â  Â  Â  Â  const docRef = await db.collection("historico").add(atividade);

Â  Â  Â  Â  console.log("Atividade salva no Firebase com ID:", docRef.id);

Â  Â  Â  Â  mostrarHistorico();

Â  Â  Â  } catch (error) {

Â  Â  Â  Â  console.error("Erro ao salvar atividade:", error);

Â  Â  Â  }

Â  Â  }



Â  Â  // FunÃ§Ã£o para mostrar histÃ³rico

Â  Â  async function mostrarHistorico() {

Â  Â  Â  const lista = document.getElementById("listaAtividades");

Â  Â  Â  lista.innerHTML = "";



Â  Â  Â  if (!auth.currentUser) {

Â  Â  Â  Â  alert("VocÃª precisa estar logado para acessar o histÃ³rico.");

Â  Â  Â  Â  return;

Â  Â  Â  }



Â  Â  Â  try {

Â  Â  Â  Â  const querySnapshot = await db.collection("historico").where("userId", "==", auth.currentUser.uid).get();

Â  Â  Â  Â  if (querySnapshot.empty) {

Â  Â  Â  Â  Â  lista.innerHTML = "<p>Nenhuma atividade encontrada.</p>";

Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }



Â  Â  Â  Â  querySnapshot.forEach((doc) => {

Â  Â  Â  Â  Â  const atv = doc.data();

Â  Â  Â  Â  Â  const div = document.createElement("div");

Â  Â  Â  Â  Â  div.className = "atividade";

Â  Â  Â  Â  Â  div.innerHTML = `

Â  Â  Â  Â  Â  Â  <strong>DescriÃ§Ã£o:</strong> ${atv.descricao}<br>

Â  Â  Â  Â  Â  Â  <strong>InÃ­cio:</strong> ${new Date(atv.inicio).toLocaleString()}<br>

Â  Â  Â  Â  Â  Â  <strong>Fim:</strong> ${new Date(atv.fim).toLocaleString()}<br>

Â  Â  Â  Â  Â  Â  <a href="${atv.url}" target="_blank">Abrir FormulÃ¡rio</a>

Â  Â  Â  Â  Â  Â  <button class="delete-btn" onclick="confirmarExclusao('${doc.id}')">Excluir</button>

Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  lista.appendChild(div);

Â  Â  Â  Â  });

Â  Â  Â  } catch (error) {

Â  Â  Â  Â  console.error("Erro ao carregar histÃ³rico:", error);

Â  Â  Â  Â  lista.innerHTML = `<p class="error">Erro ao carregar histÃ³rico: ${error.message}</p>`;

Â  Â  Â  }

Â  Â  }



Â  Â  // FunÃ§Ã£o para confirmar e excluir uma atividade

Â  Â  async function confirmarExclusao(docId) {

Â  Â  Â  const confirmar = confirm("Tem certeza de que deseja excluir esta atividade?");

Â  Â  Â  if (confirmar) {

Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  await db.collection("historico").doc(docId).delete();

Â  Â  Â  Â  Â  console.log("Atividade excluÃ­da com sucesso:", docId);

Â  Â  Â  Â  Â  mostrarHistorico(); // Atualiza o histÃ³rico apÃ³s exclusÃ£o

Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  console.error("Erro ao excluir atividade:", error);

Â  Â  Â  Â  Â  alert("Erro ao excluir atividade: " + error.message);

Â  Â  Â  Â  }

Â  Â  Â  }

Â  Â  }

Â  </script>

</body>

</html>
