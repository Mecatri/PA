<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Controle de Gastos - Casamento Â· Mobile (Compartilhado)</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* (Mantive o estilo mobile-first otimizado do arquivo anterior) */
:root{
Â  Â  --bg:#fbfaf7;--card:#ffffff;--muted:#6b6b6b;--accent:#8B5E3C;--accent-2:#D9B873;
Â  Â  --success:#3a9d56;--danger:#c9302c;--warn:#c87f00;--shadow:0 8px 24px rgba(22,22,22,0.08);
}
*{box-sizing:border-box;}html,body{height:100%;}
body {
Â  Â  /* ... outras propriedades ... */
Â  Â Â 
Â  Â  /* â¡ï¸ COMBINA IMAGEM COM GRADIENTE (sobreposiÃ§Ã£o) */
Â  Â  background:Â 
Â  Â  Â  Â  linear-gradient(180deg, rgba(251, 250, 247, 0.5), rgba(255, 254, 252, 0.7)),Â 
Â  Â  Â  Â  url('https://recreio.com.br/wp-content/uploads/disney/carl_e_ellie.jpg');
Â  Â  Â  Â Â 
Â  Â  background-size: cover;
Â  Â  background-attachment: fixed;
}
.container{max-width:460px;margin:0 auto;background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(255,255,255,0.96));
Â  Â  border-radius:16px;padding:14px;box-shadow:var(--shadow);}
.header{text-align:center;margin-bottom:10px;}
.header h1{margin:0;font-family:'Playfair Display',serif;font-size:1.25rem;color:var(--accent);line-height:1.1;}
.header p{margin:6px 0 0;color:var(--muted);font-size:0.9rem;}
.summary{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px;margin:12px 0;}
.card{background:var(--card);border-radius:12px;padding:10px 12px;box-shadow:0 6px 18px rgba(20,20,20,0.03);
Â  Â  min-width:150px;display:flex;flex-direction:column;gap:6px;flex:0 0 auto;}
.card .label{font-weight:700;color:var(--muted);font-size:0.83rem;}
.card .value{font-weight:800;font-size:1rem;color:var(--accent);}
.btn-primary{background:linear-gradient(90deg,var(--accent-2),#cd9f52);border:none;color:#fff;padding:12px 14px;border-radius:12px;
Â  Â  font-weight:800;cursor:pointer;box-shadow:0 6px 14px rgba(205,159,82,0.16);font-size:1rem;min-height:48px;width:100%;}
.btn-clear{background:#f5f5f5;border-radius:10px;padding:10px 12px;border:1px solid #eee;cursor:pointer;font-weight:700;}
.form{background:linear-gradient(180deg,#fff,#fbfbfb);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px;
Â  Â  box-shadow:0 6px 14px rgba(18,18,18,0.03);margin-bottom:10px;}
.input,select{padding:12px 14px;border-radius:10px;border:1px solid #e6e6e6;font-size:1rem;background:#fff;width:100%;}
.form-actions{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap;}
.table-wrap{margin-top:8px;}table{width:100%;border-collapse:collapse;}thead{display:none;}tbody{display:block;}
tr{display:block;margin:10px 0;background:#fff;border-radius:12px;padding:10px;box-shadow:0 6px 18px rgba(10,10,10,0.03);}
td{display:flex;justify-content:space-between;padding:6px 0;border:none;font-size:0.95rem;align-items:center;}
td::before{content:attr(data-label);font-weight:700;color:var(--muted);margin-right:8px;width:40%;font-size:0.9rem;}
.row-action{display:flex;flex-direction:column;gap:8px;margin-top:6px;}
.btn-small{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;font-size:0.95rem;width:100%;text-align:center;}
.btn-edit{background:#fff7ec;color:#8b5e3c;border:1px solid #fdeed8;}
.btn-delete{background:#fff0f0;color:var(--danger);border:1px solid #ffecec;}
.alert-orange td{background:#fff7ee;color:var(--warn);font-weight:700;border-radius:8px;}
.alert-red td{background:#fff0f0;color:var(--danger);font-weight:700;border-radius:8px;}
.modal-backdrop{position:fixed;inset:0;background:rgba(10,10,10,0.45);display:none;align-items:flex-end;justify-content:center;z-index:999;}
.modal{background:var(--card);border-top-left-radius:16px;border-top-right-radius:16px;padding:16px;width:100%;max-height:92vh;overflow:auto;box-shadow:0 -6px 24px rgba(20,20,20,0.18);}
.modal h3{margin:0 0 8px;color:var(--accent);font-family:'Playfair Display',serif;} .modal .row{display:flex;flex-direction:column;gap:8px;margin-bottom:10px;}
.small{font-size:0.85rem;color:var(--muted);} .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
@media(min-width:880px){ /* manutenÃ§Ã£o opcional desktop */ }
</style>
</head>
<body>
<div class="container">
Â  Â  <div class="header">
Â  Â  Â  Â  <h1>ğŸ’ Controle de Gastos do Casamento</h1>
Â  Â  Â  Â  <p class="small">Compartilhado em tempo real â€” todos veem e podem editar.</p>
Â  Â  </div>

Â  Â  <section class="summary" aria-hidden="false">
Â  Â  Â  Â  <div class="card pago"><div class="label">Pago â€” Noivo</div><div class="value" id="total-pago-noivo">R$ 0,00</div></div>
Â  Â  Â  Â  <div class="card pago"><div class="label">Pago â€” Noiva</div><div class="value" id="total-pago-noiva">R$ 0,00</div></div>
Â  Â  Â  Â  <div class="card geral"><div class="label">Total Pago</div><div class="value" id="total-pago-geral">R$ 0,00</div></div>
Â  Â  Â  Â  <div class="card apagar"><div class="label">A Pagar â€” Noivo</div><div class="value" id="total-apagar-noivo">R$ 0,00</div></div>
Â  Â  Â  Â  <div class="card apagar"><div class="label">A Pagar â€” Noiva</div><div class="value" id="total-apagar-noiva">R$ 0,00</div></div>
Â  Â  Â  Â  <div class="card apagar"><div class="label">Total a Pagar</div><div class="value" id="total-apagar-geral">R$ 0,00</div></div>
Â  Â  </section>

Â  Â  <form id="form" class="form" autocomplete="off">
Â  Â  Â  Â  <input id="item" class="input" type="text" placeholder="Item" required />
Â  Â  Â  Â  <input id="valor" class="input" type="number" min="0" step="0.01" placeholder="Valor (R$)" required />
Â  Â  Â  Â  <select id="status" class="input" required>
Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Status</option>
Â  Â  Â  Â  Â  Â  <option value="Pago">Pago</option>
Â  Â  Â  Â  Â  Â  <option value="A Pagar">A Pagar</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <select id="responsavel" class="input" required>
Â  Â  Â  Â  Â  Â  <option value="" disabled selected>ResponsÃ¡vel</option>
Â  Â  Â  Â  Â  Â  <option value="Noivo">Noivo</option>
Â  Â  Â  Â  Â  Â  <option value="Noiva">Noiva</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <input id="data" class="input" type="date" placeholder="Data" />
Â  Â  Â  Â  <div class="form-actions" style="width:100%;">
Â  Â  Â  Â  Â  Â  <button type="submit" class="btn-primary">Adicionar Gasto</button>
Â  Â  Â  Â  Â  Â  <div style="display:flex;gap:8px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="export-csv" class="btn-clear">Exportar</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="clear-all" class="btn-clear">Limpar</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </form>

Â  Â  <div class="table-wrap" role="region" aria-label="Lista de gastos">
Â  Â  Â  Â  <table id="tabela" aria-describedby="lista-desc">
Â  Â  Â  Â  Â  Â  <thead><tr><th>Item</th><th>Valor</th><th>Status</th><th>ResponsÃ¡vel</th><th>Data</th><th>AÃ§Ãµes</th></tr></thead>
Â  Â  Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  Â  <div id="lista-desc" class="small" style="margin-top:8px;color:var(--muted)">
Â  Â  Â  Â  Â  Â  Dados compartilhados em tempo real. Qualquer alteraÃ§Ã£o Ã© visÃ­vel a todos.
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div class="modal-backdrop" id="modal-backdrop" aria-hidden="true">
Â  Â  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-title">
Â  Â  Â  Â  <h3 id="edit-title">Editar LanÃ§amento</h3>
Â  Â  Â  Â  <div class="row"><label class="small" for="edit-item">Item</label><input id="edit-item" class="input" type="text" /></div>
Â  Â  Â  Â  <div class="row"><label class="small" for="edit-valor">Valor</label><input id="edit-valor" class="input" type="number" min="0" step="0.01" /></div>
Â  Â  Â  Â  <div class="row"><label class="small" for="edit-status">Status</label><select id="edit-status" class="input"><option>Pago</option><option>A Pagar</option></select></div>
Â  Â  Â  Â  <div class="row"><label class="small" for="edit-resp">ResponsÃ¡vel</label><select id="edit-resp" class="input"><option>Noivo</option><option>Noiva</option></select></div>
Â  Â  Â  Â  <div class="row"><label class="small" for="edit-data">Data</label><input id="edit-data" class="input" type="date" /></div>
Â  Â  Â  Â  <div style="display:flex;gap:10px;justify-content:space-between;margin-top:8px;">
Â  Â  Â  Â  Â  Â  <button id="cancel-edit" class="btn-clear">Cancelar</button>
Â  Â  Â  Â  Â  Â  <button id="save-edit" class="btn-primary">Salvar</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<!-- Firebase SDKs (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
/*
Â  IntegraÃ§Ã£o Firestore:
Â  - Este script conecta a sua pÃ¡gina ao Firestore e salva/edita/remove lanÃ§amentos na coleÃ§Ã£o "gastos".
Â  - SubstituÃ­ o placeholder do firebaseConfig pelo seu projeto (dispesas-9082a), use regras seguras no Firestore.
Â  - Para testes rÃ¡pidos, vocÃª pode permitir read/write temporariamente nas regras (nÃ£o recomendado em produÃ§Ã£o).
*/

const firebaseConfig = {
Â  apiKey: "AIzaSyBjncnSGojzX6WumANGgQDrzYWnU696YCQ",
Â  authDomain: "dispesas-9082a.firebaseapp.com",
Â  projectId: "dispesas-9082a",
Â  storageBucket: "dispesas-9082a.firebasestorage.app",
Â  messagingSenderId: "574298243285",
Â  appId: "1:574298243285:web:78f35eccfe8ae37a3ba25c",
Â  measurementId: "G-EXMCETLB5N"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let gastos = []; // array local espelho
const ids = {
Â  Â  tabelaBody: document.querySelector('#tabela tbody'),
Â  Â  totalPagoNoivo: document.getElementById('total-pago-noivo'),
Â  Â  totalPagoNoiva: document.getElementById('total-pago-noiva'),
Â  Â  totalPagoGeral: document.getElementById('total-pago-geral'),
Â  Â  totalApagarNoivo: document.getElementById('total-apagar-noivo'),
Â  Â  totalApagarNoiva: document.getElementById('total-apagar-noiva'),
Â  Â  totalApagarGeral: document.getElementById('total-apagar-geral'),
Â  Â  form: document.getElementById('form'),
Â  Â  itemIn: document.getElementById('item'),
Â  Â  valorIn: document.getElementById('valor'),
Â  Â  statusIn: document.getElementById('status'),
Â  Â  respIn: document.getElementById('responsavel'),
Â  Â  dataIn: document.getElementById('data'),
Â  Â  modalBackdrop: document.getElementById('modal-backdrop'),
Â  Â  editItem: document.getElementById('edit-item'),
Â  Â  editValor: document.getElementById('edit-valor'),
Â  Â  editStatus: document.getElementById('edit-status'),
Â  Â  editResp: document.getElementById('edit-resp'),
Â  Â  editData: document.getElementById('edit-data'),
Â  Â  saveEditBtn: document.getElementById('save-edit'),
Â  Â  cancelEditBtn: document.getElementById('cancel-edit'),
Â  Â  exportCsvBtn: document.getElementById('export-csv'),
Â  Â  clearAllBtn: document.getElementById('clear-all')
};

function formatBRL(v){ return Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }
function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }
function escapeCsv(s){ if(s==null) return ''; s=String(s); if(s.includes('"')||s.includes(',')||s.includes('\n')||s.includes('\r')) return '"' + s.replace(/"/g,'""') + '"'; return s; }

function render(){
Â  Â  ids.tabelaBody.innerHTML = '';
Â  Â  let pagoNoivo = 0, pagoNoiva = 0, apagarNoivo = 0, apagarNoiva = 0;
Â  Â  const hoje = new Date(); hoje.setHours(0,0,0,0);

Â  Â  gastos.forEach((g, idx) => {
Â  Â  Â  Â  const val = Number(g.valor||0);
Â  Â  Â  Â  if (g.status === "Pago") {
Â  Â  Â  Â  Â  Â  if (g.responsavel === "Noivo") pagoNoivo += val;
Â  Â  Â  Â  Â  Â  else if (g.responsavel === "Noiva") pagoNoiva += val;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (g.responsavel === "Noivo") apagarNoivo += val;
Â  Â  Â  Â  Â  Â  else if (g.responsavel === "Noiva") apagarNoiva += val;
Â  Â  Â  Â  }

Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  let alertClass = '';
Â  Â  Â  Â  if (g.status === "A Pagar" && g.data) {
Â  Â  Â  Â  Â  Â  const dt = new Date(g.data); dt.setHours(0,0,0,0);
Â  Â  Â  Â  Â  Â  const diffDays = Math.ceil((dt - hoje) / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  if (diffDays < 0) alertClass = 'alert-red';
Â  Â  Â  Â  Â  Â  else if (diffDays <= 7) alertClass = 'alert-orange';
Â  Â  Â  Â  }
Â  Â  Â  Â  if (alertClass) tr.classList.add(alertClass);

Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  <td data-label="Item"><span>${escapeHtml(g.item)}</span></td>
Â  Â  Â  Â  Â  Â  <td data-label="Valor"><span>${formatBRL(g.valor)}</span></td>
Â  Â  Â  Â  Â  Â  <td data-label="Status"><span>${escapeHtml(g.status)}</span></td>
Â  Â  Â  Â  Â  Â  <td data-label="ResponsÃ¡vel"><span>${escapeHtml(g.responsavel)}</span></td>
Â  Â  Â  Â  Â  Â  <td data-label="Data"><span>${g.data ? (new Date(g.data)).toLocaleDateString('pt-BR') : '-'}</span></td>
Â  Â  Â  Â  Â  Â  <td data-label="AÃ§Ãµes">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="row-action">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-small btn-edit" type="button" data-id="${g._id}">Editar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-small btn-delete" type="button" data-id="${g._id}">Remover</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </td>`;
Â  Â  Â  Â  ids.tabelaBody.appendChild(tr);
Â  Â  });

Â  Â  ids.totalPagoNoivo.textContent = formatBRL(pagoNoivo);
Â  Â  ids.totalPagoNoiva.textContent = formatBRL(pagoNoiva);
Â  Â  ids.totalPagoGeral.textContent = formatBRL(pagoNoivo + pagoNoiva);
Â  Â  ids.totalApagarNoivo.textContent = formatBRL(apagarNoivo);
Â  Â  ids.totalApagarNoiva.textContent = formatBRL(apagarNoiva);
Â  Â  ids.totalApagarGeral.textContent = formatBRL(apagarNoivo + apagarNoiva);

Â  Â  // bind action buttons (delegation simple)
Â  Â  ids.tabelaBody.querySelectorAll('.btn-delete').forEach(btn=>{
Â  Â  Â  Â  btn.onclick = ()=> removeItem(btn.dataset.id);
Â  Â  });
Â  Â  ids.tabelaBody.querySelectorAll('.btn-edit').forEach(btn=>{
Â  Â  Â  Â  btn.onclick = ()=> openEditModal(btn.dataset.id);
Â  Â  });
}

/* --- Firestore real-time listener --- */
const gastosQuery = db.collection('gastos').orderBy('createdAt', 'asc');

gastosQuery.onSnapshot(snapshot => {
Â  Â  const arr = [];
Â  Â  snapshot.forEach(doc => {
Â  Â  Â  Â  const d = doc.data();
Â  Â  Â  Â  arr.push({
Â  Â  Â  Â  Â  Â  _id: doc.id,
Â  Â  Â  Â  Â  Â  item: d.item || '',
Â  Â  Â  Â  Â  Â  valor: Number(d.valor || 0),
Â  Â  Â  Â  Â  Â  status: d.status || 'A Pagar',
Â  Â  Â  Â  Â  Â  responsavel: d.responsavel || 'Noivo',
Â  Â  Â  Â  Â  Â  data: d.data || '',
Â  Â  Â  Â  Â  Â  createdAt: d.createdAt ? d.createdAt.toDate?.() || d.createdAt : null
Â  Â  Â  Â  });
Â  Â  });
Â  Â  gastos = arr;
Â  Â  render();
}, err => {
Â  Â  console.error('Erro ao escutar Firestore:', err);
});

/* Adicionar novo gasto (grava no Firestore) */
ids.form.addEventListener('submit', ev=>{
Â  Â  ev.preventDefault();
Â  Â  const item = ids.itemIn.value.trim();
Â  Â  const valor = parseFloat(ids.valorIn.value);
Â  Â  const status = ids.statusIn.value;
Â  Â  const resp = ids.respIn.value;
Â  Â  const data = ids.dataIn.value || '';

Â  Â  if(!item || isNaN(valor) || valor <= 0 || !status || !resp) return alert('Preencha todos os campos.');
Â  Â  if(status === 'A Pagar' && !data) return alert('Informe a data para "A Pagar".');

Â  Â  db.collection('gastos').add({
Â  Â  Â  Â  item,
Â  Â  Â  Â  valor: Number(valor.toFixed(2)),
Â  Â  Â  Â  status,
Â  Â  Â  Â  responsavel: resp,
Â  Â  Â  Â  data,
Â  Â  Â  Â  createdAt: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  }).then(()=>{
Â  Â  Â  Â  ids.form.reset();
Â  Â  Â  Â  // UI serÃ¡ atualizado pelo listener onSnapshot
Â  Â  }).catch(err=>{
Â  Â  Â  Â  console.error('Erro ao adicionar:', err);
Â  Â  Â  Â  alert('NÃ£o foi possÃ­vel adicionar. Tente novamente.');
Â  Â  });
});

/* Remover por id */
function removeItem(id){
Â  Â  if(!id) return;
Â  Â  if(!confirm('Remover este lanÃ§amento?')) return;
Â  Â  db.collection('gastos').doc(id).delete().catch(err=>{
Â  Â  Â  Â  console.error('Erro ao remover:', err);
Â  Â  Â  Â  alert('Falha ao remover.');
Â  Â  });
}

/* EdiÃ§Ã£o: abrir modal com dados do doc */
let editingId = null;
function openEditModal(id){
Â  Â  if(!id) return;
Â  Â  editingId = id;
Â  Â  db.collection('gastos').doc(id).get().then(doc=>{
Â  Â  Â  Â  if(!doc.exists) return alert('LanÃ§amento nÃ£o encontrado (pode ter sido removido).');
Â  Â  Â  Â  const d = doc.data();
Â  Â  Â  Â  ids.editItem.value = d.item || '';
Â  Â  Â  Â  ids.editValor.value = d.valor || 0;
Â  Â  Â  Â  ids.editStatus.value = d.status || 'A Pagar';
Â  Â  Â  Â  ids.editResp.value = d.responsavel || 'Noivo';
Â  Â  Â  Â  ids.editData.value = d.data || '';
Â  Â  Â  Â  ids.modalBackdrop.style.display = 'flex';
Â  Â  Â  Â  ids.modalBackdrop.setAttribute('aria-hidden','false');
Â  Â  Â  Â  ids.editItem.focus();
Â  Â  }).catch(err=>{
Â  Â  Â  Â  console.error('Erro ao carregar documento:', err);
Â  Â  Â  Â  alert('Erro ao carregar para ediÃ§Ã£o.');
Â  Â  });
}

/* Salvar ediÃ§Ã£o */
ids.saveEditBtn.onclick = ()=>{
Â  Â  if(!editingId) return;
Â  Â  const item = ids.editItem.value.trim();
Â  Â  const valor = parseFloat(ids.editValor.value);
Â  Â  const status = ids.editStatus.value;
Â  Â  const resp = ids.editResp.value;
Â  Â  const data = ids.editData.value || '';

Â  Â  if(!item || isNaN(valor) || valor <= 0 || !status || !resp) return alert('Preencha todos os campos.');
Â  Â  if(status === 'A Pagar' && !data) return alert('Informe a data para "A Pagar".');

Â  Â  db.collection('gastos').doc(editingId).update({
Â  Â  Â  Â  item,
Â  Â  Â  Â  valor: Number(valor.toFixed(2)),
Â  Â  Â  Â  status,
Â  Â  Â  Â  responsavel: resp,
Â  Â  Â  Â  data,
Â  Â  Â  Â  updatedAt: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  }).then(()=>{
Â  Â  Â  Â  editingId = null;
Â  Â  Â  Â  ids.modalBackdrop.style.display = 'none';
Â  Â  Â  Â  ids.modalBackdrop.setAttribute('aria-hidden','true');
Â  Â  }).catch(err=>{
Â  Â  Â  Â  console.error('Erro ao salvar ediÃ§Ã£o:', err);
Â  Â  Â  Â  alert('Falha ao salvar alteraÃ§Ãµes.');
Â  Â  });
};

/* Cancelar ediÃ§Ã£o */
ids.cancelEditBtn.onclick = ()=>{
Â  Â  editingId = null;
Â  Â  ids.modalBackdrop.style.display = 'none';
Â  Â  ids.modalBackdrop.setAttribute('aria-hidden','true');
};

/* Export CSV - gera a partir do array local (jÃ¡ sincronizado) */
ids.exportCsvBtn.onclick = ()=>{
Â  Â  if(!gastos.length) return alert('Nenhum lanÃ§amento para exportar.');
Â  Â  const headers = ['Item','Valor','Status','ResponsÃ¡vel','Data'];
Â  Â  const rows = gastos.map(g => [
Â  Â  Â  Â  escapeCsv(g.item),
Â  Â  Â  Â  (Number(g.valor||0)).toFixed(2),
Â  Â  Â  Â  g.status,
Â  Â  Â  Â  g.responsavel,
Â  Â  Â  Â  g.data || ''
Â  Â  ]);
Â  Â  const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\r\n');
Â  Â  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
Â  Â  const url = URL.createObjectURL(blob);
Â  Â  const a = document.createElement('a'); a.href = url; a.download = 'gastos_casamento_shared.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};

/* Limpar todos: apagar todos os docs da coleÃ§Ã£o (perigoso em produÃ§Ã£o) */
ids.clearAllBtn.onclick = async ()=>{
Â  Â  if(!confirm('Remover todos os lanÃ§amentos? Esta aÃ§Ã£o apagarÃ¡ todos os registros para todos os usuÃ¡rios.')) return;
Â  Â  try{
Â  Â  Â  Â  const snap = await db.collection('gastos').get();
Â  Â  Â  Â  const batch = db.batch();
Â  Â  Â  Â  snap.forEach(doc => batch.delete(doc.ref));
Â  Â  Â  Â  await batch.commit();
Â  Â  Â  Â  alert('Todos os lanÃ§amentos removidos.');
Â  Â  }catch(err){
Â  Â  Â  Â  console.error('Erro ao limpar todos:', err);
Â  Â  Â  Â  alert('Falha ao limpar.');
Â  Â  }
};

/* Escuta ESC para fechar modal */
document.addEventListener('keydown', (e)=>{
Â  Â  if(e.key === 'Escape'){
Â  Â  Â  Â  editingId = null;
Â  Â  Â  Â  ids.modalBackdrop.style.display = 'none';
Â  Â  Â  Â  ids.modalBackdrop.setAttribute('aria-hidden','true');
Â  Â  }
});

/* clique no backdrop fecha modal */
ids.modalBackdrop.addEventListener('click', (ev)=>{
Â  Â  if(ev.target === ids.modalBackdrop){
Â  Â  Â  Â  editingId = null;
Â  Â  Â  Â  ids.modalBackdrop.style.display = 'none';
Â  Â  Â  Â  ids.modalBackdrop.setAttribute('aria-hidden','true');
Â  Â  }
});
</script>
</body>
</html>
