<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Controle de Gastos - Casamento ¬∑ Mobile</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* MOBILE-FIRST: totalmente otimizado para telas pequenas (smartphones) */
/* Cores e tokens */
:root{
    --bg:#fbfaf7;
    --card:#ffffff;
    --muted:#6b6b6b;
    --accent:#8B5E3C;
    --accent-2:#D9B873;
    --success:#3a9d56;
    --danger:#c9302c;
    --warn:#c87f00;
    --shadow:0 8px 24px rgba(22,22,22,0.08);
    --radius:14px;
    --gap:12px;
}

/* Reset / base */
*{box-sizing:border-box;}
html,body{height:100%;}
body{
    margin:0;
    font-family:'Poppins',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:linear-gradient(180deg,#fbfaf7 0%,#fffefc 100%);
    color:#222;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:12px;
    -webkit-tap-highlight-color: transparent;
}

/* Container (narrow para mobile) */
.container{
    max-width:460px;
    margin:0 auto;
    background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(255,255,255,0.96));
    border-radius:16px;
    padding:14px;
    box-shadow:var(--shadow);
}

/* Header */
.header{text-align:center;margin-bottom:10px;}
.header h1{
    margin:0;
    font-family:'Playfair Display',serif;
    font-size:1.25rem;
    color:var(--accent);
    line-height:1.1;
}
.header p{margin:6px 0 0;color:var(--muted);font-size:0.9rem;}

/* SUMMARY - horizontal scrollable cards to save vertical space */
.summary{
    display:flex;
    gap:10px;
    overflow-x:auto;
    padding-bottom:6px;
    margin:12px 0;
}
.summary::-webkit-scrollbar{height:8px;}
.summary::-webkit-scrollbar-thumb{background:#eee;border-radius:8px;}
.card{
    background:var(--card);
    border-radius:12px;
    padding:10px 12px;
    box-shadow:0 6px 18px rgba(20,20,20,0.03);
    min-width:150px;
    display:flex;
    flex-direction:column;
    gap:6px;
    flex:0 0 auto;
}
.card .label{font-weight:700;color:var(--muted);font-size:0.83rem;}
.card .value{font-weight:800;font-size:1rem;color:var(--accent);}

/* Buttons (touch-friendly) */
.btn-primary{
    background:linear-gradient(90deg,var(--accent-2),#cd9f52);
    border:none;
    color:#fff;
    padding:12px 14px;
    border-radius:12px;
    font-weight:800;
    cursor:pointer;
    box-shadow:0 6px 14px rgba(205,159,82,0.16);
    font-size:1rem;
    min-height:48px;
    width:100%;
}
.btn-clear{
    background:#f5f5f5;border-radius:10px;padding:10px 12px;border:1px solid #eee;cursor:pointer;font-weight:700;
}

/* FORM - single column, inputs maiores */
.form{
    background:linear-gradient(180deg,#fff,#fbfbfb);
    border-radius:12px;
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    box-shadow:0 6px 14px rgba(18,18,18,0.03);
    margin-bottom:10px;
}
.input, select{
    padding:12px 14px;
    border-radius:10px;
    border:1px solid #e6e6e6;
    font-size:1rem;
    background:#fff;
    width:100%;
}
.form-actions{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap;}

/* TABLE - mobile card/list style by default */
.table-wrap{margin-top:8px;}
table{width:100%;border-collapse:collapse;}
thead{display:none;} /* hiding header on mobile - cards have labels */
tbody{display:block;}
tr{
    display:block;
    margin:10px 0;
    background:#fff;
    border-radius:12px;
    padding:10px;
    box-shadow:0 6px 18px rgba(10,10,10,0.03);
}
td{
    display:flex;
    justify-content:space-between;
    padding:6px 0;
    border:none;
    font-size:0.95rem;
    align-items:center;
}
td::before{
    content:attr(data-label);
    font-weight:700;
    color:var(--muted);
    margin-right:8px;
    width:40%;
    font-size:0.9rem;
}
.row-action{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-top:6px;
}
.btn-small{
    padding:10px 12px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:700;
    font-size:0.95rem;
    width:100%;
    text-align:center;
}
.btn-edit{background:#fff7ec;color:#8b5e3c;border:1px solid #fdeed8;}
.btn-delete{background:#fff0f0;color:var(--danger);border:1px solid #ffecec;}

/* Alert rows */
.alert-orange td{background:#fff7ee;color:var(--warn);font-weight:700;border-radius:8px;}
.alert-red td{background:#fff0f0;color:var(--danger);font-weight:700;border-radius:8px;}

/* MODAL - full-screen friendly on mobile */
.modal-backdrop{
    position:fixed;inset:0;background:rgba(10,10,10,0.45);
    display:none;align-items:flex-end;justify-content:center;z-index:999;
}
.modal{
    background:var(--card);
    border-top-left-radius:16px;
    border-top-right-radius:16px;
    padding:16px;
    width:100%;
    max-height:92vh;
    overflow:auto;
    box-shadow:0 -6px 24px rgba(20,20,20,0.18);
}
.modal h3{margin:0 0 8px;color:var(--accent);font-family:'Playfair Display',serif;}
.modal .row{display:flex;flex-direction:column;gap:8px;margin-bottom:10px;}
.small{font-size:0.85rem;color:var(--muted);}

/* Accessibility helper */
.sr-only{
    position:absolute!important;
    width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
}

/* DESKTOP: optional ‚Äî keep a usable layout for wider screens, but mobile-first remains */
@media(min-width:880px){
    body{padding:20px;}
    .container{max-width:1100px;padding:18px;border-radius:18px;}
    .summary{overflow:visible;flex-wrap:wrap;}
    .form{flex-direction:row;gap:12px;align-items:flex-end;}
    .form .input{width:100%;}
    .form .form-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 200px;gap:10px;width:100%;}
    thead{display:table-header-group;}
    tr{display:table-row;margin:0;background:transparent;padding:0;box-shadow:none;border-radius:0;}
    td{display:table-cell;padding:12px;border-bottom:1px solid #f1f1f1;}
    td::before{display:none;}
    .row-action{flex-direction:column;align-items:flex-end;gap:6px;}
    .modal{width:clamp(420px,60%,720px);border-radius:12px;box-shadow:0 12px 32px rgba(20,20,20,0.14);position:relative;top:0;}
    .modal-backdrop{align-items:center;}
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üíç Controle de Gastos do Casamento</h1>
        <p class="small">Resumo financeiro, vencimentos e gerenciamento ‚Äî otimizado para mobile.</p>
    </div>

    <section class="summary" aria-hidden="false">
        <div class="card pago"><div class="label">Pago ‚Äî Noivo</div><div class="value" id="total-pago-noivo">R$ 0,00</div></div>
        <div class="card pago"><div class="label">Pago ‚Äî Noiva</div><div class="value" id="total-pago-noiva">R$ 0,00</div></div>
        <div class="card geral"><div class="label">Total Pago</div><div class="value" id="total-pago-geral">R$ 0,00</div></div>
        <div class="card apagar"><div class="label">A Pagar ‚Äî Noivo</div><div class="value" id="total-apagar-noivo">R$ 0,00</div></div>
        <div class="card apagar"><div class="label">A Pagar ‚Äî Noiva</div><div class="value" id="total-apagar-noiva">R$ 0,00</div></div>
        <div class="card apagar"><div class="label">Total a Pagar</div><div class="value" id="total-apagar-geral">R$ 0,00</div></div>
    </section>

    <form id="form" class="form" autocomplete="off">
        <input id="item" class="input" type="text" placeholder="Item" required />
        <input id="valor" class="input" type="number" min="0" step="0.01" placeholder="Valor (R$)" required />
        <select id="status" class="input" required>
            <option value="" disabled selected>Status</option>
            <option value="Pago">Pago</option>
            <option value="A Pagar">A Pagar</option>
        </select>
        <select id="responsavel" class="input" required>
            <option value="" disabled selected>Respons√°vel</option>
            <option value="Noivo">Noivo</option>
            <option value="Noiva">Noiva</option>
        </select>
        <input id="data" class="input" type="date" placeholder="Data" />
        <div class="form-actions" style="width:100%;">
            <button type="submit" class="btn-primary">Adicionar Gasto</button>
            <div style="display:flex;gap:8px;">
                <button type="button" id="export-csv" class="btn-clear">Exportar</button>
                <button type="button" id="clear-all" class="btn-clear">Limpar</button>
            </div>
        </div>
    </form>

    <div class="table-wrap" role="region" aria-label="Lista de gastos">
        <table id="tabela" aria-describedby="lista-desc">
            <thead>
                <tr><th>Item</th><th>Valor</th><th>Status</th><th>Respons√°vel</th><th>Data</th><th>A√ß√µes</th></tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="lista-desc" class="small" style="margin-top:8px;color:var(--muted)">Toque em "Editar" para alterar um lan√ßamento. Linhas vencidas aparecem em vermelho.</div>
    </div>
</div>

<div class="modal-backdrop" id="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-title">
        <h3 id="edit-title">Editar Lan√ßamento</h3>
        <div class="row">
            <label class="small" for="edit-item">Item</label>
            <input id="edit-item" class="input" type="text" />
        </div>
        <div class="row">
            <label class="small" for="edit-valor">Valor</label>
            <input id="edit-valor" class="input" type="number" min="0" step="0.01" />
        </div>
        <div class="row">
            <label class="small" for="edit-status">Status</label>
            <select id="edit-status" class="input"><option>Pago</option><option>A Pagar</option></select>
        </div>
        <div class="row">
            <label class="small" for="edit-resp">Respons√°vel</label>
            <select id="edit-resp" class="input"><option>Noivo</option><option>Noiva</option></select>
        </div>
        <div class="row">
            <label class="small" for="edit-data">Data</label>
            <input id="edit-data" class="input" type="date" />
        </div>
        <div style="display:flex;gap:10px;justify-content:space-between;margin-top:8px;">
            <button id="cancel-edit" class="btn-clear">Cancelar</button>
            <button id="save-edit" class="btn-primary">Salvar</button>
        </div>
    </div>
</div>

<script>
let gastos=[];
const ids={
    tabelaBody:document.querySelector('#tabela tbody'),
    totalPagoNoivo:document.getElementById('total-pago-noivo'),
    totalPagoNoiva:document.getElementById('total-pago-noiva'),
    totalPagoGeral:document.getElementById('total-pago-geral'),
    totalApagarNoivo:document.getElementById('total-apagar-noivo'),
    totalApagarNoiva:document.getElementById('total-apagar-noiva'),
    totalApagarGeral:document.getElementById('total-apagar-geral'),
    form:document.getElementById('form'),
    itemIn:document.getElementById('item'),
    valorIn:document.getElementById('valor'),
    statusIn:document.getElementById('status'),
    respIn:document.getElementById('responsavel'),
    dataIn:document.getElementById('data'),
    modalBackdrop:document.getElementById('modal-backdrop'),
    editItem:document.getElementById('edit-item'),
    editValor:document.getElementById('edit-valor'),
    editStatus:document.getElementById('edit-status'),
    editResp:document.getElementById('edit-resp'),
    editData:document.getElementById('edit-data'),
    saveEditBtn:document.getElementById('save-edit'),
    cancelEditBtn:document.getElementById('cancel-edit'),
    exportCsvBtn:document.getElementById('export-csv'),
    clearAllBtn:document.getElementById('clear-all')
};

function formatBRL(v){return Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});}
function render(){
    ids.tabelaBody.innerHTML='';
    let pagoNoivo=0,pagoNoiva=0,apagarNoivo=0,apagarNoiva=0;
    const hoje=new Date();hoje.setHours(0,0,0,0);
    gastos.forEach((g,idx)=>{
        const val=Number(g.valor||0);
        if(g.status==="Pago"){
            if(g.responsavel==="Noivo") pagoNoivo+=val;
            else if(g.responsavel==="Noiva") pagoNoiva+=val;
        } else {
            if(g.responsavel==="Noivo") apagarNoivo+=val;
            else if(g.responsavel==="Noiva") apagarNoiva+=val;
        }

        const tr=document.createElement('tr');
        let alertClass='';
        if(g.status==="A Pagar"&&g.data){
            const dt=new Date(g.data);dt.setHours(0,0,0,0);
            const diffDays=Math.ceil((dt-hoje)/(1000*60*60*24));
            if(diffDays<0)alertClass='alert-red';else if(diffDays<=7)alertClass='alert-orange';
        }
        if(alertClass)tr.classList.add(alertClass);

        tr.innerHTML=`
        <td data-label="Item"><span>${escapeHtml(g.item)}</span></td>
        <td data-label="Valor"><span>${formatBRL(g.valor)}</span></td>
        <td data-label="Status"><span>${escapeHtml(g.status)}</span></td>
        <td data-label="Respons√°vel"><span>${escapeHtml(g.responsavel)}</span></td>
        <td data-label="Data"><span>${g.data?(new Date(g.data)).toLocaleDateString('pt-BR'):'-'}</span></td>
        <td data-label="A√ß√µes">
            <div class="row-action">
                <button class="btn-small btn-edit" type="button" data-idx="${idx}">Editar</button>
                <button class="btn-small btn-delete" type="button" data-idx="${idx}">Remover</button>
            </div>
        </td>`;
        ids.tabelaBody.appendChild(tr);
    });
    ids.totalPagoNoivo.textContent=formatBRL(pagoNoivo);
    ids.totalPagoNoiva.textContent=formatBRL(pagoNoiva);
    ids.totalPagoGeral.textContent=formatBRL(pagoNoivo+pagoNoiva);
    ids.totalApagarNoivo.textContent=formatBRL(apagarNoivo);
    ids.totalApagarNoiva.textContent=formatBRL(apagarNoiva);
    ids.totalApagarGeral.textContent=formatBRL(apagarNoivo+apagarNoiva);

    // bind actions
    ids.tabelaBody.querySelectorAll('.btn-delete').forEach(btn=>{
        btn.onclick = ()=> removeItem(Number(btn.dataset.idx));
    });
    ids.tabelaBody.querySelectorAll('.btn-edit').forEach(btn=>{
        btn.onclick = ()=> openEditModal(Number(btn.dataset.idx));
    });
}

ids.form.addEventListener('submit',ev=>{
    ev.preventDefault();
    const item=ids.itemIn.value.trim(),valor=parseFloat(ids.valorIn.value),
    status=ids.statusIn.value,resp=ids.respIn.value,data=ids.dataIn.value||'';
    if(!item||isNaN(valor)||valor<=0||!status||!resp)return alert('Preencha todos os campos.');
    if(status==='A Pagar'&&!data)return alert('Informe a data para "A Pagar".');
    gastos.push({item,valor,status,responsavel:resp,data});
    ids.form.reset();render();
});
function removeItem(i){if(confirm('Remover este lan√ßamento?')){gastos.splice(i,1);render();}}
let editingIndex=null;
function openEditModal(i){
    editingIndex=i;const g=gastos[i];
    ids.editItem.value=g.item;ids.editValor.value=g.valor;ids.editStatus.value=g.status;ids.editResp.value=g.responsavel;ids.editData.value=g.data;
    ids.modalBackdrop.style.display='flex';
    ids.modalBackdrop.setAttribute('aria-hidden','false');
    ids.editItem.focus();
    document.addEventListener('keydown', modalKeyHandler);
}
ids.cancelEditBtn.onclick=()=>{ids.modalBackdrop.style.display='none';ids.modalBackdrop.setAttribute('aria-hidden','true');editingIndex=null;document.removeEventListener('keydown', modalKeyHandler);};
ids.saveEditBtn.onclick=()=>{
    const i=editingIndex;if(i===null)return;
    const item=ids.editItem.value.trim(),valor=parseFloat(ids.editValor.value),status=ids.editStatus.value,resp=ids.editResp.value,data=ids.editData.value||'';
    if(!item||isNaN(valor)||valor<=0||!status||!resp)return alert('Preencha todos os campos.');
    if(status==='A Pagar'&&!data)return alert('Informe a data para "A Pagar".');
    gastos[i]={item,valor,status,responsavel:resp,data};
    ids.modalBackdrop.style.display='none';
    ids.modalBackdrop.setAttribute('aria-hidden','true');
    editingIndex=null;
    document.removeEventListener('keydown', modalKeyHandler);
    render();
};
function modalKeyHandler(e){ if(e.key==='Escape'){ ids.modalBackdrop.style.display='none'; ids.modalBackdrop.setAttribute('aria-hidden','true'); editingIndex=null; document.removeEventListener('keydown', modalKeyHandler); } }

// Export CSV (simples)
ids.exportCsvBtn.onclick=()=>{
    if(!gastos.length)return alert('Nenhum lan√ßamento para exportar.');
    const headers=['Item','Valor','Status','Respons√°vel','Data'];
    const rows=gastos.map(g=>[escapeCsv(g.item),(Number(g.valor||0)).toFixed(2),g.status,g.responsavel,g.data||'']);
    const csv=[headers.join(','),...rows.map(r=>r.map(c=>c).join(','))].join('\r\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='gastos_casamento.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};
// Clear all
ids.clearAllBtn.onclick=()=>{ if(!gastos.length) return; if(confirm('Remover todos os lan√ßamentos?')){gastos=[];render();} };

function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }
function escapeCsv(s){ if(s==null) return ''; s=String(s); if(s.includes('"')||s.includes(',')||s.includes('\n')||s.includes('\r')) return '"'+s.replace(/"/g,'""')+'"'; return s; }

render();
</script>
</body>
</html>
